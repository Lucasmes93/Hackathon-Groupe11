# Rapport de Pentest — Container Docker `mcp_server`

**Date** : 2025-07-02  
**Utilisateur** : kali@kali  
**Système** : Linux kali 6.6.0-kali1-amd64  
**Container** : `mcp_server`  
**IP interne Docker** : `172.17.0.2`

---

## Table des matières

1. [Résumé](#résumé)
2. [Containers Docker actifs](#containers-docker-actifs)
3. [Analyse réseau locale](#analyse-réseau-locale)
4. [Analyse interne du container](#analyse-interne-du-container)
5. [Ports détectés](#ports-détectés)
6. [Base de données détectée](#base-de-données-détectée)
7. [Privilèges et process](#privilèges-et-process)
8. [Réseau Docker](#réseau-docker)
9. [Conclusions & pistes](#conclusions--pistes)

---

## Résumé

| Élément                  | Détail                                      |
|--------------------------|---------------------------------------------|
| Nom du container         | `mcp_server`                                |
| Service principal        | `Werkzeug httpd 2.3.0 (Python)`             |
| Port API                 | `8080` (exposé sur localhost)               |
| Base de données          | MongoDB 6.0.5 (port 27017 interne)          |
| Privilèges               | Container **non privilégié**                |
| Fichiers SUID            | `sudo`, `newgrp`                            |
| Utilisateur système      | `root`, `app`                               |
| Communication réseau     | OK (flux localhost et inter-container)      |

---

## Containers Docker actifs

```bash
docker ps -a
```

```
CONTAINER ID   IMAGE            COMMAND             CREATED         STATUS         PORTS                     NAMES
4fa6a9e27d5d   mcp_server:dev   "python3 server.py"  5 minutes ago   Up 5 minutes   0.0.0.0:8080->8080/tcp    mcp_server
```

---

## Analyse réseau locale

### Scan de `localhost`

```bash
nmap -sV -p- -T4 localhost
```

```
PORT     STATE SERVICE VERSION
8080/tcp open  http    Werkzeug httpd 2.3.0 (Python 3.10.12)
```

### Scan de l'IP interne Docker

```bash
nmap -sV -p- -T4 172.17.0.2
```

```
PORT     STATE SERVICE VERSION
8080/tcp open  http    Werkzeug httpd 2.3.0
27017/tcp open  mongodb MongoDB 6.0.5
```

### Test de connectivité API

```bash
nc -vz 172.17.0.2 8080
```

```
Connection to 172.17.0.2 8080 port [tcp/http-alt] succeeded!
```

---

## Analyse interne du container

### Vérification du socket Docker

```bash
docker exec mcp_server ls -l /var/run/docker.sock
```

```
ls: cannot access '/var/run/docker.sock': No such file or directory
```

 Aucun accès à la socket Docker depuis le conteneur

---

## Ports détectés

| Port | Service   | Description                    |
|------|-----------|--------------------------------|
| 8080 | Werkzeug  | API HTTP (chatbot backend)     |
| 27017| MongoDB   | Base de données interne        |

---

## Base de données détectée

### Processus MongoDB

```bash
docker exec mcp_server ps aux | grep mongod
```

```
mongodb     24  0.1  1.0 161244 40884 ?  Ssl  mongod --config /etc/mongod.conf
```

 MongoDB tourne localement dans le conteneur

---

## Privilèges et process

### Fichiers avec SUID

```bash
docker exec mcp_server find / -perm -4000 -type f
```

```
/usr/bin/sudo  
/usr/bin/newgrp
```

### Utilisateurs définis

```bash
docker exec mcp_server cat /etc/passwd | grep -v 'nologin'
```

```
root:x:0:0:root:/root:/bin/bash  
app:x:1000:1000::/home/app:/bin/bash
```

### Mode d’exécution privilégié

```bash
docker inspect --format='{{.HostConfig.Privileged}}' mcp_server
```

```
false
```

 Le conteneur **n’est pas privilégié**

### Liste des processus actifs

```bash
docker exec mcp_server ps aux
```

```
root         1  0.0  0.1  76488  9380 ?   Ss   python3 server.py  
mongodb     24  0.1  1.0 161244 40884 ?  Ssl  mongod --config /etc/mongod.conf
```

---

## Réseau Docker

### Scan du réseau interne

```bash
nmap -sP 172.17.0.0/16
```

```
Nmap scan report for 172.17.0.1  
Host is up (0.00030s latency).  

Nmap scan report for 172.17.0.2  
Host is up (0.00012s latency).
```

---

## Conclusions & pistes

| Axe                     | Évaluation                                    |
|-------------------------|-----------------------------------------------|
| API HTTP                | Actif sur port 8080, framework Flask/Werkzeug |
| Authentification API    | Non vérifiée — à tester                       |
| MongoDB                 | En écoute sur 27017, potentiellement exposé   |
| Container privilégié    | Non                                         |
| Escalade interne        | Sudo présent — vérifier `sudo -l`             |
| Communication chatbot ↔ DB | Confirmée par les process `server.py` + `mongod` |

### Pistes d’audit complémentaire

- Tester les endpoints `/api`, `/chat`, `/admin` via `curl` ou `ffuf`
- Vérifier la présence d’injections NoSQL sur les paramètres utilisateur
- Vérifier si MongoDB nécessite une authentification
- Tenter une élévation via `sudo -l` si mal configuré
- Monitorer les échanges entre chatbot et base Mongo pour fuite d'infos

---


## Commandes utilisées dans le script de test automatique

```bash
# Lister les containers
docker ps -a

# Scanner localhost
nmap -sV -p- -T4 localhost

# Scanner l'IP Docker (par exemple 172.17.0.2)
nmap -sV -p- -T4 172.17.0.2

# Test de connectivité aux ports
nc -vz 172.17.0.2 8080

# Vérifier socket Docker dans le conteneur
docker exec mcp_server ls -l /var/run/docker.sock

# Fichiers avec SUID
docker exec mcp_server find / -perm -4000 -type f

# Afficher les utilisateurs
docker exec mcp_server cat /etc/passwd | grep -v 'nologin'

# Vérifier privilèges
docker inspect --format='{{.HostConfig.Privileged}}' mcp_server

# Voir les processus actifs
docker exec mcp_server ps aux

# Voir les processus Mongo
docker exec mcp_server ps aux | grep mongod

# Scanner le réseau interne Docker
nmap -sP 172.17.0.0/16
```


---

## Tests supplémentaires : HTTP, FTP, SSH

###  Test HTTP - page racine

```bash
curl -i http://172.17.0.2:8080/
```

###  Test HTTP - recherche de endpoints communs

```bash
ffuf -u http://172.17.0.2:8080/FUZZ -w /usr/share/wordlists/dirb/common.txt -mc all
```

###  Test FTP (port 21)

```bash
nmap -p 21 -sV 172.17.0.2
```

###  Connexion FTP

```bash
ftp 172.17.0.2
```

(Si le service est actif)

###  Test SSH (port 22)

```bash
nmap -p 22 -sV 172.17.0.2
```

###  Tentative de connexion SSH

```bash
ssh app@172.17.0.2
```


---
